
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CSC3007 Assignment 4</title>
  <style></style>
</head>

<body>
<svg></svg>
<script src="https://d3js.org/d3.v7.min.js"></script>

<script>

let width = 1000, height = 500;

// Initialize the SVG by creating the viewbox
let svg = d3.select("svg")
    .attr("viewBox", "0 0 " + width + " " + height)

// Load external data
Promise.all([d3.json("links-sample.json"), d3.json("cases-sample.json")]).then(data => {

    // For creating the links
    // https://www.d3indepth.com/force-layout/#forcelink
    // https://bl.ocks.org/mbostock/4062045
    // https://bl.ocks.org/GerardoFurtado/91368069a381009d30468aa9774c0de3/e58316dfdb05b68b02e5692c26b360c990da0383

    // Data preprocessing
    // Create the links for linking the nodes
    data[0].forEach(e => {
        e.source = e.infector;
        e.target = e.infectee;
    });

    console.log("links", data[0]); //links
    console.log("cases", data[1]); //cases


    // Create the link path to the svg
    let linkpath = svg.append("g")
    .attr("id", "links")
    .selectAll("path")
    .data(data[0])
    .enter()
    .append("path")
    .attr("fill", "none")
    .attr("stroke", "black");

    // Create the circles based on the size of cases data
    let node = svg.append("g")
    .attr("id", "nodes")
    .selectAll("circle")
    .data(data[1])
    .enter()
    .append("circle")
    .attr("r", 10)
    // Set the color of the circle based on gender
    .style('fill',function(d) {
        if(d.gender == "female") {
            return "pink";
        } else {
            return "#3489eb";
        }
    })
    .style('stroke', "black")
    .style('stroke-width', 1)
    .call(d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended));

    // Create the simulation with links
    let simulation = d3.forceSimulation()
    .nodes(data[1])
    .force("link", d3.forceLink(data[0])
        .id(d => d.id)
        .distance(30) // distance between each node
        .strength(0.5) 
    )
    .force("charge", d3.forceManyBody().strength(-3))
    .force("collide", d3.forceCollide().strength(0.5).radius(20))
    .force('center', d3.forceCenter(width / 2, height / 2))
    .on("tick", d => {
        node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);
        
        linkpath
        .attr("d", d => "M" + d.source.x + "," + d.source.y + " " + d.target.x + "," + d.target.y);
    });
    console.log(simulation.nodes())
    console.log(simulation.force("link").links())

    // Drag event functions
    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.5).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }

    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }

})
</script>

</body>
</html>